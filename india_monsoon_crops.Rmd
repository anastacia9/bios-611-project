---
title: "india_monsoon_crops"
author: "Anastacia Wienecke"
date: "`r Sys.Date()`"
output: html_document
---

``` {r fig.height = 10, fig.width = 10}
#options(timeout = 600)
#install.packages('dplyr')
#install.packages('ggplot2')
#install.packages('ggmap')
#install.packages('sf')
#install.packages('terra')
#install.packages('mapview')
library(dplyr)
library(ggplot2)
library(ggmap)
library(sf)
library(mapview)
webshot::install_phantomjs()
library(htmlwidgets)
library(viridis)
citation("ggmap")

rains <- read.csv("data/india_rains.csv") %>% 
         select(-Name,-Jan.Feb,-Mar.May,-June.September,-Oct.Dec)

# Plot sample locations on the map
latlong <- rains %>%
           select(SUBDIVISION, Latitude, Longitude) %>%
           distinct()
latlong <- meds %>%
           left_join(latlong, by = c("SUBDIVISION"))

breaks <- seq(from = 280, to = 3700, by = 300)
pal <- magma(n = length(breaks), direction = -1)
india <- mapview(latlong, xcol = "Longitude", ycol = "Latitude", crs = 4269, grid = FALSE, zcol="median", col.regions = pal, at = breaks)
india
mapshot(india, file = "india.png")
saveWidget(india@map, file="india.html")

# Plot median annual rainfal
latlongmeds <- meds %>%
               left_join(latlong, by = c("SUBDIVISION"))


# Basic barplots of annual rainfall for 1901, 1925, 1950, 1975, 2000, and 2017
rains.per25years <- rains %>% filter(YEAR %in% c(1901,1925,1950,1975,2000,2017))
ggplot(data=rains.per25years, aes(x=SUBDIVISION, y=ANNUAL)) +
    geom_bar(stat="identity") +
     scale_x_discrete(guide = guide_axis(angle = 90)) +
     facet_grid(YEAR ~ ., scales = "free_y") +
     coord_cartesian(ylim = c(0, 4500))

# Get median annual rainfall for each region
meds <- rains %>%
        group_by(SUBDIVISION) %>%
        summarise_at(vars(ANNUAL), list(median=median, variance=var))
meds$stdev <- sqrt(meds$variance)
meds$stdev.norm <- meds$stdev / meds$median


# Trends of annual rainfall between 1901-2017 for all 36 regions
ggplot(data=rains.per25years, aes(x=YEAR, y=ANNUAL, group=SUBDIVISION, color=SUBDIVISION)) +
       geom_line()

# Plot of median rainfall vs. variability in rainfall
meds <- rains %>%
        group_by(SUBDIVISION) %>%
        summarise_at(vars(ANNUAL), list(median=median, variance=var))
meds$stdev <- sqrt(meds$variance)
meds$stdev.norm <- meds$stdev / meds$median
  # non-normalized
  ggplot(data=meds, aes(x=median, y=stdev.norm)) +
         geom_line() +
         geom_point()
  # normalized
  ggplot(data=meds, aes(x=median, y=stdev.norm)) +
         geom_line() +
         geom_point()

ggplot(data=rains, aes(x=Latitude, y=Longitude))+
       geom_point()



#ggsave(g, height = 14, width = 7)
#unique(rains$SUBDIVISION)
#unique(rains$YEAR)
#crops <- read.csv("data/india_crops.csv")



```



